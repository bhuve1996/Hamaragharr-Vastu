
<section {% render 'section-attr' %}>
  {% render 'section-bg-image' %}
  <xo-container {% render 'section-layout' %}>
    {% assign has_visible_items = false %}
    {% for block in section.blocks %}
      {% if block.settings.image != blank or block.settings.product != blank %}
        {% assign has_visible_items = true %}
        {% break %}
      {% endif %}
    {% endfor %}
    {% if section.settings.title != blank and has_visible_items %}
      <xo-animate xo-cascade>
        <h2 class='vastu-best-seller__section-title' style='--title-font-size: {{ section.settings.title_font_size | default: 3.5 }}rem; --title-font-weight: {{ section.settings.title_font_weight | default: 700 }}; --title-underline-color: {{ section.settings.title_underline_color | default: "#473855" }}; --title-underline-width: {{ section.settings.title_underline_width | default: 80 }}px; --title-underline-height: {{ section.settings.title_underline_height | default: 4 }}px;'>{{ section.settings.title | upcase }}</h2>
      </xo-animate>
    {% endif %}
    {% assign visible_blocks_count = 0 %}
    {% for block in section.blocks %}
      {% if block.settings.image != blank or block.settings.product != blank %}
        {% assign visible_blocks_count = visible_blocks_count | plus: 1 %}
      {% endif %}
    {% endfor %}
    
    {% if visible_blocks_count > 3 %}
      {% comment %} Use carousel when more than 3 items {% endcomment %}
      <xo-carousel
        xo-per-view='3'
        xo-gap='30'
        xo-speed='400'
        xo-breakpoints='
        {
          992: {
            perView: 2,
          },
          768: {
            perView: 1,
          },
          576: {
            perView: 1,
          },
        }
        '
        xo-render-bullet='<span></span>'
      >
        <xo-carousel-inner>
          <xo-carousel-list role='list' aria-label='{{ 'general.slider.name' | t }}'>
            {% for block in section.blocks %}
              {% if block.settings.image != blank or block.settings.product != blank %}
                {% assign product_link = block.settings.link %}
                {% if block.settings.product != blank %}
                  {% assign product_link = all_products[block.settings.product].url %}
                {% endif %}
                <xo-carousel-slide aria-roledescription='{{ 'sections.slideshow.slide' | t }}' aria-label='{{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}'>
                  <div class='vastu-best-seller-card' {{ block.shopify_attributes }}>
                    {% if block.settings.product != blank %}
                      {% assign current_product = all_products[block.settings.product] %}
                      <xo-product xo-product-id='{{ current_product.id }}' xo-section-id='{{ section.id }}' xo-product-information>
                    {% endif %}
                    <a href='{{ product_link }}' class='vastu-best-seller-card__link'>
                      {% if block.settings.image != blank %}
                        <div class='vastu-best-seller-card__image hover-style--scale-up'>
                          {% comment %}
                          {% if block.settings.badge != blank %}
                            <span class='vastu-best-seller-card__badge' style='--badge-font-size: {{ section.settings.badge_font_size | default: 0.9 }}rem; --badge-padding-h: {{ section.settings.badge_padding_horizontal | default: 12 }}px; --badge-padding-v: {{ section.settings.badge_padding_vertical | default: 6 }}px; --badge-top: {{ section.settings.badge_top_position | default: 12 }}px; --badge-right: {{ section.settings.badge_right_position | default: 12 }}px;'>{{ block.settings.badge }}</span>
                          {% endif %}
                          {% endcomment %}
                          {% if block.settings.product != blank and current_product.price != blank %}
                            <p class='vastu-best-seller-card__price vastu-best-seller-card__price--overlay' style='--card-price-size: {{ section.settings.card_price_font_size | default: 1.2 }}rem;'>{{ current_product.price | money }}</p>
                          {% endif %}
                          {% render 'image', image: block.settings.image, media_aspect_ratio: '4/3' %}
                        </div>
                      {% elsif block.settings.product != blank %}
                        <div class='vastu-best-seller-card__image hover-style--scale-up'>
                          {% comment %}
                          {% if block.settings.badge != blank %}
                            <span class='vastu-best-seller-card__badge' style='--badge-font-size: {{ section.settings.badge_font_size | default: 0.9 }}rem; --badge-padding-h: {{ section.settings.badge_padding_horizontal | default: 12 }}px; --badge-padding-v: {{ section.settings.badge_padding_vertical | default: 6 }}px; --badge-top: {{ section.settings.badge_top_position | default: 12 }}px; --badge-right: {{ section.settings.badge_right_position | default: 12 }}px;'>{{ block.settings.badge }}</span>
                          {% endif %}
                          {% endcomment %}
                          {% if current_product.price != blank %}
                            <p class='vastu-best-seller-card__price vastu-best-seller-card__price--overlay' style='--card-price-size: {{ section.settings.card_price_font_size | default: 1.2 }}rem;'>{{ current_product.price | money }}</p>
                          {% endif %}
                          {% if current_product.featured_image != blank %}
                            {% render 'image', image: current_product.featured_image, media_aspect_ratio: '4/3' %}
                          {% else %}
                            {{ 'product-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
                          {% endif %}
                        </div>
                      {% endif %}
                      <div class='vastu-best-seller-card__content' style='--content-padding-top: {{ section.settings.card_content_padding_top | default: 1.5 }}rem; --content-padding-bottom: {{ section.settings.card_content_padding_bottom | default: 0.5 }}rem;'>
                        {% comment %} Auto-populate title: Use manual title if provided, otherwise use product title {% endcomment %}
                        {% assign display_title = block.settings.title %}
                        {% if display_title == blank and block.settings.product != blank %}
                          {% assign display_title = current_product.title %}
                        {% endif %}
                        {% if display_title != blank %}
                          <h3 class='vastu-best-seller-card__title' style='--card-title-size: {{ section.settings.card_title_font_size | default: 1.5 }}rem;' title='{{ display_title | escape }}'>{{ display_title }}</h3>
                        {% endif %}
                        {% comment %} Auto-populate description: Use manual description if provided, otherwise use product description {% endcomment %}
                        {% assign display_description = block.settings.description %}
                        {% if display_description == blank and block.settings.product != blank %}
                          {% assign display_description = current_product.description | strip_html | truncate: 100 %}
                        {% endif %}
                        {% if display_description != blank %}
                          <p class='vastu-best-seller-card__description'>{{ display_description }}</p>
                        {% endif %}
                        {% if block.settings.product != blank %}
                          <div class='vastu-best-seller-card__add-to-cart'>
                            {% if current_product.variants.size > 1 %}
                              {% assign button_text = section.settings.button_text_select_options | default: 'Select Options' %}
                              <xo-toggle-trigger xo-name='product-variant-modal-{{ current_product.id }}-{{ section.id }}'>
                                {% render 'button', text: button_text, style: 'secondary', mode: 'light', size: 'md', block: true %}
                              </xo-toggle-trigger>
                            {% else %}
                              {% assign button_text = section.settings.button_text_add_to_cart | default: 'Add to Cart' %}
                              <xo-cart-add {% if current_product.selected_or_first_available_variant.available == false %}xo-disabled{% endif %}>
                                {% render 'button', text: button_text, style: 'secondary', mode: 'light', size: 'md', block: true %}
                              </xo-cart-add>
                            {% endif %}
                          </div>
                        {% endif %}
                      </div>
                    </a>
                    {% if block.settings.product != blank %}
                      {% if current_product.variants.size > 1 %}
                        {% render 'product-variant-modal', product: current_product, variant_modal_placement: 'default' %}
                      {% endif %}
                      </xo-product>
                    {% endif %}
                  </div>
                </xo-carousel-slide>
              {% endif %}
            {% endfor %}
          </xo-carousel-list>
        </xo-carousel-inner>
        {% render 'carousel-pagination-style3', class: 'vastu-best-seller__pagination' %}
      </xo-carousel>
    {% else %}
      {% comment %} Use grid when 3 or fewer items {% endcomment %}
      <xo-grid style='--xs: 1; --sm: 1; --md: 2; --lg: 3; --xl: 3; --xxl: 3; --xo-grid-col-gap: 30px; --xo-grid-row-gap: 30px;'>
        {% for block in section.blocks %}
          {% if block.settings.image != blank or block.settings.product != blank %}
            {% assign product_link = block.settings.link %}
            {% if block.settings.product != blank %}
              {% assign product_link = all_products[block.settings.product].url %}
            {% endif %}
            <div class='vastu-best-seller-card' {{ block.shopify_attributes }}>
              {% if block.settings.product != blank %}
                {% assign current_product = all_products[block.settings.product] %}
                <xo-product xo-product-id='{{ current_product.id }}' xo-section-id='{{ section.id }}' xo-product-information>
              {% endif %}
              <a href='{{ product_link }}' class='vastu-best-seller-card__link'>
                  {% if block.settings.image != blank %}
                    <div class='vastu-best-seller-card__image hover-style--scale-up'>
                      {% comment %}
                      {% if block.settings.badge != blank %}
                        <span class='vastu-best-seller-card__badge'>{{ block.settings.badge }}</span>
                      {% endif %}
                      {% endcomment %}
                      {% if block.settings.product != blank and current_product.price != blank %}
                        <p class='vastu-best-seller-card__price vastu-best-seller-card__price--overlay' style='--card-price-size: {{ section.settings.card_price_font_size | default: 1.2 }}rem;'>{{ current_product.price | money }}</p>
                      {% endif %}
                      {% render 'image', image: block.settings.image, media_aspect_ratio: '4/3' %}
                    </div>
                  {% elsif block.settings.product != blank %}
                    <div class='vastu-best-seller-card__image hover-style--scale-up'>
                      {% comment %}
                      {% if block.settings.badge != blank %}
                        <span class='vastu-best-seller-card__badge'>{{ block.settings.badge }}</span>
                      {% endif %}
                      {% endcomment %}
                      {% if current_product.price != blank %}
                        <p class='vastu-best-seller-card__price vastu-best-seller-card__price--overlay' style='--card-price-size: {{ section.settings.card_price_font_size | default: 1.2 }}rem;'>{{ current_product.price | money }}</p>
                      {% endif %}
                      {% if current_product.featured_image != blank %}
                        {% render 'image', image: current_product.featured_image, media_aspect_ratio: '4/3' %}
                      {% else %}
                        {{ 'product-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
                      {% endif %}
                    </div>
                  {% endif %}
                <div class='vastu-best-seller-card__content' style='--content-padding-top: {{ section.settings.card_content_padding_top | default: 1.5 }}rem; --content-padding-bottom: {{ section.settings.card_content_padding_bottom | default: 0.5 }}rem;'>
                  {% if block.settings.title != blank %}
                    <h3 class='vastu-best-seller-card__title' style='--card-title-size: {{ section.settings.card_title_font_size | default: 20 }}px;' title='{{ block.settings.title | escape }}'>{{ block.settings.title }}</h3>
                  {% elsif block.settings.product != blank %}
                    <h3 class='vastu-best-seller-card__title' style='--card-title-size: {{ section.settings.card_title_font_size | default: 20 }}px;' title='{{ current_product.title | escape }}'>{{ current_product.title }}</h3>
                  {% endif %}
                  {% if block.settings.description != blank %}
                    <p class='vastu-best-seller-card__description'>{{ block.settings.description }}</p>
                  {% elsif block.settings.product != blank %}
                    <p class='vastu-best-seller-card__description'>{{ current_product.description | strip_html | truncate: 100 }}</p>
                  {% endif %}
                  {% if block.settings.product != blank %}
                    <div class='vastu-best-seller-card__add-to-cart'>
                      {% if current_product.variants.size > 1 %}
                        {% assign button_text = section.settings.button_text_select_options | default: 'Select Options' %}
                        <xo-toggle-trigger xo-name='product-variant-modal-{{ current_product.id }}-{{ section.id }}'>
                          {% render 'button', text: button_text, style: 'secondary', mode: 'light', size: 'md', block: true %}
                        </xo-toggle-trigger>
                      {% else %}
                        {% assign button_text = section.settings.button_text_add_to_cart | default: 'Add to Cart' %}
                        <xo-cart-add {% if current_product.selected_or_first_available_variant.available == false %}xo-disabled{% endif %}>
                          {% render 'button', text: button_text, style: 'secondary', mode: 'light', size: 'md', block: true %}
                        </xo-cart-add>
                      {% endif %}
                    </div>
                  {% endif %}
                </div>
              </a>
              {% if block.settings.product != blank %}
                {% if current_product.variants.size > 1 %}
                  {% render 'product-variant-modal', product: current_product, variant_modal_placement: 'default' %}
                {% endif %}
                </xo-product>
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </xo-grid>
    {% endif %}
  </xo-container>
    {% render 'section-separator',
    enable_separator: section.settings.enable_separator,
    separator_color: section.settings.separator_color,
    separator_height: section.settings.separator_height,
    separator_width: section.settings.separator_width,
    padding_top: section.settings.separator_padding_top,
    padding_bottom: section.settings.separator_padding_bottom
  %}
</section>

{% schema %}
{
  "name": "Vastu Best Seller Cards",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "select",
      "id": "width",
      "label": "t:sections.all.width.label",
      "default": "box",
      "options": [
        {
          "value": "box",
          "label": "t:sections.all.width.options__1.label"
        },
        {
          "value": "wide",
          "label": "t:sections.all.width.options__2.label"
        },
        {
          "value": "fullwidth",
          "label": "t:sections.all.width.options__3.label"
        }
      ]
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Best Sellers"
    },
    {
      "type": "header",
      "content": "Heading Styling"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "min": 2,
      "max": 6,
      "step": 0.1,
      "unit": "rem",
      "label": "Title Font Size",
      "default": 3.5
    },
    {
      "type": "range",
      "id": "title_font_weight",
      "min": 400,
      "max": 900,
      "step": 100,
      "label": "Title Font Weight",
      "default": 700
    },
    {
      "type": "color",
      "id": "title_underline_color",
      "label": "Title Underline Color",
      "default": "#473855"
    },
    {
      "type": "range",
      "id": "title_underline_width",
      "min": 40,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Title Underline Width",
      "default": 80
    },
    {
      "type": "range",
      "id": "title_underline_height",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Title Underline Height",
      "default": 4
    },
    {
      "type": "header",
      "content": "t:sections.all.heading.content"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.color_scheme.label"
    },
    {
      "type": "select",
      "id": "background_type",
      "label": "t:sections.all.background_type.label",
      "options": [
        {
          "value": "color",
          "label": "t:sections.all.background_type.option__1.label"
        },
        {
          "value": "gradient",
          "label": "t:sections.all.background_type.option__2.label"
        }
      ],
      "default": "color"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "t:sections.all.background_color.label",
      "alpha": true,
      "visible_if": "{{ section.settings.background_type == 'color' }}"
    },
    {
      "type": "number",
      "id": "padding_top",
      "label": "t:sections.all.padding_top.label",
      "default": 80
    },
    {
      "type": "number",
      "id": "padding_bottom",
      "label": "t:sections.all.padding_bottom.label",
      "default": 80
    },
    {
      "type": "header",
      "content": "Section Separator"
    },
    {
      "type": "checkbox",
      "id": "enable_separator",
      "label": "Enable Separator",
      "default": false
    },
    {
      "type": "color",
      "id": "separator_color",
      "label": "Separator Color",
      "default": "#473855"
    },
    {
      "type": "range",
      "id": "separator_height",
      "min": 1,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Separator Height",
      "default": 2
    },
    {
      "type": "range",
      "id": "separator_width",
      "min": 5,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Separator Width",
      "default": 10
    },
    {
      "type": "number",
      "id": "separator_padding_top",
      "label": "Separator Top Padding",
      "default": 15
    },
    {
      "type": "number",
      "id": "separator_padding_bottom",
      "label": "Separator Bottom Padding",
      "default": 15
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "text",
      "id": "button_text_add_to_cart",
      "label": "Add to Cart Button Text",
      "default": "Add to Cart"
    },
    {
      "type": "text",
      "id": "button_text_select_options",
      "label": "Select Options Button Text",
      "default": "Select Options"
    },
    {
      "type": "header",
      "content": "Card Styling"
    },
    {
      "type": "range",
      "id": "card_title_font_size",
      "min": 1,
      "max": 3,
      "step": 0.1,
      "unit": "rem",
      "label": "Card Title Font Size",
      "default": 1.5
    },
    {
      "type": "range",
      "id": "card_price_font_size",
      "min": 1,
      "max": 2.5,
      "step": 0.1,
      "unit": "rem",
      "label": "Card Price Font Size",
      "default": 1.2
    },
    {
      "type": "range",
      "id": "card_content_padding_top",
      "min": 0.5,
      "max": 3,
      "step": 0.1,
      "unit": "rem",
      "label": "Card Content Top Padding",
      "default": 1.5
    },
    {
      "type": "range",
      "id": "card_content_padding_bottom",
      "min": 0.1,
      "max": 2,
      "step": 0.1,
      "unit": "rem",
      "label": "Card Content Bottom Padding",
      "default": 0.5
    },
    {
      "type": "header",
      "content": "Badge Styling"
    },
    {
      "type": "range",
      "id": "badge_font_size",
      "min": 0.5,
      "max": 1.5,
      "step": 0.1,
      "unit": "rem",
      "label": "Badge Font Size",
      "default": 0.9
    },
    {
      "type": "range",
      "id": "badge_padding_horizontal",
      "min": 4,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Badge Horizontal Padding",
      "default": 12
    },
    {
      "type": "range",
      "id": "badge_padding_vertical",
      "min": 2,
      "max": 12,
      "step": 1,
      "unit": "px",
      "label": "Badge Vertical Padding",
      "default": 6
    },
    {
      "type": "range",
      "id": "badge_top_position",
      "min": 4,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Badge Top Position",
      "default": 12
    },
    {
      "type": "range",
      "id": "badge_right_position",
      "min": 4,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Badge Right Position",
      "default": 12
    }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Best Seller Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product",
          "info": "⚠️ SELECT PRODUCT FIRST - This will auto-populate image, title, description, and price on the frontend. You can override by manually filling fields below."
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image (Optional)",
          "info": "Leave blank to use product image automatically"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title (Optional)",
          "info": "Leave blank to use product title automatically"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description (Optional)",
          "info": "Leave blank to use product description automatically"
        },
        {
          "type": "text",
          "id": "badge",
          "label": "Badge (Optional)"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Manual Link",
          "info": "Only used if no product is selected above. If product is selected, product URL is used automatically."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Vastu Best Seller Cards",
      "blocks": [
        {
          "type": "card",
          "settings": {
            "title": "Wall Art",
            "badge": ""
          }
        },
        {
          "type": "card",
          "settings": {
            "title": "Vastu Kit",
            "badge": "Best Seller"
          }
        },
        {
          "type": "card",
          "settings": {
            "title": "Notes from Vastu",
            "badge": ""
          }
        }
      ]
    }
  ]
}
{% endschema %}

{% render 'vastu-product-card-actions' %}

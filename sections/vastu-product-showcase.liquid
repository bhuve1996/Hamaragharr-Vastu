{% comment %}
  Renders a product showcase section similar to product page layout
  Left: Product images with thumbnails
  Right: Product description, price, quantity, add to cart, buy now
{% endcomment %}

{% liquid
  comment
    Get product from settings - use product selector or fallback handle
  endcomment
  if section.settings.product != blank
    assign selected_product = section.settings.product
  elsif section.settings.fallback_product_handle != blank
    assign selected_product = all_products[section.settings.fallback_product_handle]
  else
    assign selected_product = all_products['vastu-kit-home-office']
  endif
%}

{% if selected_product != blank %}
  {% comment %} Assign product variable for snippets that expect it {% endcomment %}
  {% assign product = selected_product %}
  
  <section {% render 'section-attr' %} class='vastu-product-showcase' {% if section.settings.background_color != blank %}style='background-color: {{ section.settings.background_color }};'{% endif %}>
    {% comment %} Inline styles to override base theme CSS that loads after vastu-sections.css {% endcomment %}
    <style>
      /* Force override base theme: .xo-product-info-media-style1 { top: 9.3rem; } */
      .vastu-product-showcase .xo-product-info-media-style1 {
        top: 0 !important;
        position: relative !important;
        margin-top: 0 !important;
        padding-top: 0 !important;
      }
      .vastu-product-showcase .xo-product-info-content {
        position: relative !important;
        top: 0 !important;
      }
    </style>
    {% render 'section-bg-image' %}
    {% comment %} Ensure product is available before xo-product component {% endcomment %}
    <xo-product xo-product-information xo-product-id='{{ product.id }}' xo-section-id='{{ section.id }}'>
      {%- assign product_form_id = 'product-showcase-form-' | append: section.id -%}
      <xo-container {% render 'section-layout' %}>
        <xo-grid>
          {% comment %} Product Images with Thumbnails {% endcomment %}
          {% assign image_col_size = section.settings.image_column_size | default: 7 %}
          {% assign content_col_size = 12 | minus: image_col_size %}
          {% if section.settings.image_position == 'right' %}
            {% comment %} Right Side: Product Info {% endcomment %}
            <xo-animate xo-cascade style='--xs: 12; --md: {{ content_col_size }}' class='vastu-product-showcase__right'>
              {% render 'vastu-product-showcase-content', product: product, section: section, product_form_id: product_form_id %}
            </xo-animate>
            
            {% comment %} Right Side: Product Images {% endcomment %}
            <xo-animate xo-cascade style='--xs: 12; --md: {{ image_col_size }}'>
              {% render 'product-info-media-showcase',
                product: product,
                section: section,
                hover_zoom_enabled: section.settings.image_zoom_hover,
                click_zoom_enabled: section.settings.image_zoom_click,
                autoplay: false,
                video_modal: false,
                product_360: false,
                media_sticky: false
              %}
            </xo-animate>
          {% else %}
            {% comment %} Left Side: Product Images {% endcomment %}
            <xo-animate xo-cascade style='--xs: 12; --md: {{ image_col_size }}'>
              {% render 'product-info-media-showcase',
                product: product,
                hover_zoom_enabled: section.settings.image_zoom_hover,
                click_zoom_enabled: section.settings.image_zoom_click,
                autoplay: false,
                video_modal: false,
                product_360: false,
                media_sticky: false
              %}
            </xo-animate>
            
            {% comment %} Right Side: Product Info {% endcomment %}
            <xo-animate xo-cascade style='--xs: 12; --md: {{ content_col_size }}' class='vastu-product-showcase__right'>
              {% render 'vastu-product-showcase-content', product: product, section: section, product_form_id: product_form_id %}
            </xo-animate>
          {% endif %}
        </xo-grid>
      </xo-container>
      {% render 'product-data', product: product %}
    </xo-product>
  </section>
  
  {% comment %} Reset product variable {% endcomment %}
  {% assign product = null %}
{% endif %}

{% schema %}
{
  "name": "Vastu Product Showcase",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Product Selection"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Product",
      "info": "Select the product to showcase. This will display all product images, description, price, and options."
    },
    {
      "type": "text",
      "id": "fallback_product_handle",
      "label": "Fallback Product Handle",
      "info": "If no product is selected above, use this product handle as fallback (e.g., 'vastu-kit-home-office')",
      "default": "vastu-kit-home-office"
    },
    {
      "type": "header",
      "content": "Display Options"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "Show Product Title",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_price",
      "label": "Show Price",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show Description",
      "default": true
    },
    {
      "type": "number",
      "id": "description_truncate_words",
      "label": "Description Word Limit",
      "info": "Number of words to show before 'Read More' link (default: 50)",
      "default": 50
    },
    {
      "type": "text",
      "id": "read_more_text",
      "label": "Read More Link Text",
      "default": "View in Detail â†’",
      "info": "Text for the 'Read More' link that appears when description is truncated"
    },
    {
      "type": "checkbox",
      "id": "show_quantity",
      "label": "Show Quantity Selector",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_buy_now",
      "label": "Show Buy Now Button",
      "default": true
    },
    {
      "type": "header",
      "content": "Image Settings"
    },
    {
      "type": "checkbox",
      "id": "image_zoom_hover",
      "label": "Enable Hover Zoom",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "image_zoom_click",
      "label": "Enable Click Zoom",
      "default": false
    },
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "padding_top",
      "label": "Padding Top",
      "default": "0"
    },
    {
      "type": "text",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "default": "0",
      "info": "Padding at the bottom of the section (e.g., '4rem' or '64px')"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "info": "Optional background color for the section"
    },
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Image Position",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left",
      "info": "Position of product images (left or right side)"
    },
    {
      "type": "range",
      "id": "image_column_size",
      "label": "Image Column Size (Desktop)",
      "min": 4,
      "max": 8,
      "step": 1,
      "default": 7,
      "info": "Column size for images on desktop (out of 12 columns). Content will take remaining space."
    },
    {
      "type": "text",
      "id": "add_to_cart_text",
      "label": "Add to Cart Button Text",
      "info": "Custom text for Add to Cart button (leave blank to use default translation)"
    },
    {
      "type": "header",
      "content": "Custom Content Override"
    },
    {
      "type": "checkbox",
      "id": "use_custom_title",
      "label": "Use Custom Title",
      "info": "If enabled, use custom title instead of product title",
      "default": false
    },
    {
      "type": "text",
      "id": "custom_title",
      "label": "Custom Title",
      "info": "Override product title with custom text"
    },
    {
      "type": "checkbox",
      "id": "use_custom_description",
      "label": "Use Custom Description",
      "info": "If enabled, use custom description instead of product description",
      "default": false
    },
    {
      "type": "richtext",
      "id": "custom_description",
      "label": "Custom Description",
      "info": "Override product description with custom content (supports HTML formatting)"
    }
  ],
  "blocks": [
    {
      "type": "custom_image",
      "name": "Custom Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Add a custom image to the product gallery. Images will be displayed in the order they appear here."
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Alt Text",
          "info": "Alternative text for the image (for accessibility)"
        }
      ]
    },
    {
      "type": "custom_text",
      "name": "Custom Text Block",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Custom Heading"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Add custom content here</p>"
        },
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "before_title",
              "label": "Before Title"
            },
            {
              "value": "after_title",
              "label": "After Title"
            },
            {
              "value": "after_price",
              "label": "After Price"
            },
            {
              "value": "after_description",
              "label": "After Description"
            },
            {
              "value": "after_buttons",
              "label": "After Buttons"
            }
          ],
          "default": "after_description",
          "info": "Where to display this custom text block"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Vastu Product Showcase"
    }
  ]
}
{% endschema %}


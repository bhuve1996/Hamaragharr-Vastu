{% comment %}
  Prevents card link from being triggered when clicking on add to cart/select options button
{% endcomment %}

<script>
(function() {
  const processedCards = new WeakSet();
  
  function setupOverlayHandlers() {
    // Handle best seller cards - prevent link navigation when clicking overlay
    document.querySelectorAll('.vastu-best-seller-card__actions-overlay').forEach(function(overlay) {
      if (processedCards.has(overlay)) return;
      processedCards.add(overlay);
      
      // Prevent the card link from receiving clicks from overlay
      // Only intercept clicks that would go to the card link, not button clicks
      const cardLink = overlay.closest('.vastu-best-seller-card')?.querySelector('.vastu-best-seller-card__link');
      if (cardLink && !cardLink.dataset.vastuHandlerAdded) {
        cardLink.dataset.vastuHandlerAdded = 'true';
        cardLink.addEventListener('click', function(e) {
          // If click originated from overlay or any interactive element inside it, prevent navigation
          const clickedElement = e.target;
          const isInteractiveElement = clickedElement.closest('button') || 
                                      clickedElement.closest('xo-toggle-trigger') || 
                                      clickedElement.closest('xo-modal-trigger') || 
                                      clickedElement.closest('xo-cart-add') || 
                                      clickedElement.closest('xo-tooltip') ||
                                      clickedElement.closest('.vastu-best-seller-card__actions-overlay');
          
          if (isInteractiveElement) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
          }
        }, false); // Use bubble phase, not capture
      }
    });
    
    // Handle featured products cards - prevent link navigation when clicking overlay
    document.querySelectorAll('.vastu-featured-products__actions-overlay').forEach(function(overlay) {
      if (processedCards.has(overlay)) return;
      processedCards.add(overlay);
      
      // Prevent the card link from receiving clicks from overlay
      // Only intercept clicks that would go to the card link, not button clicks
      const cardLink = overlay.closest('.vastu-featured-products__card')?.querySelector('.vastu-featured-products__link');
      if (cardLink && !cardLink.dataset.vastuHandlerAdded) {
        cardLink.dataset.vastuHandlerAdded = 'true';
        cardLink.addEventListener('click', function(e) {
          // If click originated from overlay or any interactive element inside it, prevent navigation
          const clickedElement = e.target;
          const isInteractiveElement = clickedElement.closest('button') || 
                                      clickedElement.closest('xo-toggle-trigger') || 
                                      clickedElement.closest('xo-modal-trigger') || 
                                      clickedElement.closest('xo-cart-add') || 
                                      clickedElement.closest('xo-tooltip') ||
                                      clickedElement.closest('.vastu-featured-products__actions-overlay');
          
          if (isInteractiveElement) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
          }
        }, false); // Use bubble phase, not capture
      }
    });
  }
  
  // Run on DOMContentLoaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupOverlayHandlers);
  } else {
    setupOverlayHandlers();
  }
  
  // Also run after a short delay to catch dynamically loaded content
  setTimeout(setupOverlayHandlers, 500);
  setTimeout(setupOverlayHandlers, 1000);
})();
</script>


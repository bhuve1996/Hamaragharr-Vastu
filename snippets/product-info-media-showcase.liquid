{% comment %}
  Renders product media for showcase section (based on product-info-media-style1)
  This version ensures images always display with proper fallbacks
  
  Accepts:
   - product: {Product} The product object (required)
   - hover_zoom_enabled: {Boolean} Whether to enable hover zoom (optional)
   - click_zoom_enabled: {Boolean} Whether to enable click zoom (optional)
   - autoplay: {Boolean} Whether to enable video autoplay (optional)
   - video_modal: {Boolean} Whether to enable video style modal (optional)
   - product_360: {Boolean} Whether to enable 360 product view (optional)
   - media_sticky: {Boolean} Enable position sticky (optional)
{% endcomment %}

{{ 'product-info-media-style1.css' | asset_url | stylesheet_tag }}

{% comment %} Ensure product is available {% endcomment %}
{% if product == blank %}
  {% assign product = all_products['vastu-kit-home-office'] %}
{% endif %}

{% comment %} Get featured media - try multiple fallbacks {% endcomment %}
{% assign featured_media = product.selected_or_first_available_variant.featured_media %}
{% if featured_media == blank %}
  {% assign featured_media = product.featured_media %}
{% endif %}
{% if featured_media == blank %}
  {% assign featured_media = product.media.first %}
{% endif %}
{% comment %} Always ensure we have at least featured_image as fallback {% endcomment %}
{% assign featured_image = product.featured_image %}
{% if featured_image == blank %}
  {% assign featured_image = product.images.first %}
{% endif %}
{% assign media_aspect_ratio = settings.product_card_aspect_ratio %}

<div
  class='xo-product-info-media-style1'
  {%- if media_sticky -%}
    style='position: sticky;'
  {%- endif -%}
>
  <xo-gallery xo-sync='false' xo-portal-class='main-product__portal' aria-label='{{ 'products.product.media.gallery_viewer' | t }}'>
    <xo-carousel xo-name='product-information-desktop'>
      <div class='xo-product-info-media-style1__bottom'>
        <xo-carousel-inner>
          <xo-carousel-list role='list' aria-label='{{ 'general.slider.name' | t }}'>
      <xo-carousel-thumbnail xo-loop class='xo-product-info-media-style1__thumbnails' xo-per-view='5' xo-gap='10'>
        <xo-carousel-inner style='padding-bottom: 0.1rem; margin-bottom: -0.1rem;'>
          <xo-carousel-list role='list' aria-label='{{ 'general.slider.name' | t }}' style='padding-right: 0.2rem; margin-right: -0.2rem;'>
            {%- if featured_media != null -%}
              {% if featured_media.media_type %}
                {% case featured_media.media_type %}
                  {% when 'image' %}
                    <xo-carousel-slide
                      aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                      aria-label='1 {{ 'general.slider.of' | t }} {{ product.media.size | default: 1 }}'
                      class='xo-product-info-media-style1__thumb-slide'
                    >
                      {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: featured_media.preview_image %}
                    </xo-carousel-slide>
                  {% when 'model' %}
                    <xo-carousel-slide
                      aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                      aria-label='1 {{ 'general.slider.of' | t }} {{ product.media.size | default: 1 }}'
                      class='xo-product-info-media-style1__thumb-slide'
                    >
                      {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: featured_media.preview_image %}
                      <div class='xo-product-info-media-style1__media-icon'>
                        {% render 'icon', name: '3d-model', icon_size: '13' %}
                      </div>
                    </xo-carousel-slide>
                  {% else %}
                    {% if video_modal == false and product_360 == false %}
                      <xo-carousel-slide
                        aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                        aria-label='1 {{ 'general.slider.of' | t }} {{ product.media.size | default: 1 }}'
                        class='xo-product-info-media-style1__thumb-slide'
                      >
                        {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: featured_media.preview_image %}
                        <div class='xo-product-info-media-style1__media-icon xo-product-info-media-style1__media-icon--play'>
                          {% render 'icon', name: 'play', icon_size: '13' %}
                        </div>
                      </xo-carousel-slide>
                    {% endif %}
                {% endcase %}
              {% else %}
                {% comment %} If featured_media exists but no media_type, treat as image {% endcomment %}
                <xo-carousel-slide
                  aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                  aria-label='1 {{ 'general.slider.of' | t }} {{ product.media.size | default: 1 }}'
                  class='xo-product-info-media-style1__thumb-slide'
                >
                  {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: featured_media.preview_image %}
                </xo-carousel-slide>
              {% endif %}
            {%- elsif featured_image != blank -%}
              {% comment %} Fallback to featured_image if no featured_media {% endcomment %}
              <xo-carousel-slide
                aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                aria-label='1 {{ 'general.slider.of' | t }} 1'
                class='xo-product-info-media-style1__thumb-slide'
              >
                {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: featured_image %}
              </xo-carousel-slide>
            {%- endif -%}
            {% if product.media.size > 0 %}
              {% for media in product.media %}
                {% if featured_media != null and featured_media.id %}
                  {% unless media.id == featured_media.id %}
                    {% case media.media_type %}
                      {% when 'image' %}
                        <xo-carousel-slide
                          aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                          aria-label='{{ forloop.index | plus: 1 }} {{ 'general.slider.of' | t }} {{ product.media.size }}'
                          class='xo-product-info-media-style1__thumb-slide'
                        >
                          {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: media.preview_image %}
                        </xo-carousel-slide>
                      {% when 'model' %}
                        <xo-carousel-slide
                          aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                          aria-label='{{ forloop.index | plus: 1 }} {{ 'general.slider.of' | t }} {{ product.media.size }}'
                          class='xo-product-info-media-style1__thumb-slide'
                        >
                          {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: media.preview_image %}
                          <div class='xo-product-info-media-style1__media-icon'>
                            {% render 'icon', name: '3d-model', icon_size: '13' %}
                          </div>
                        </xo-carousel-slide>
                      {% else %}
                        {% if video_modal == false and product_360 == false %}
                          <xo-carousel-slide
                            aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                            aria-label='{{ forloop.index | plus: 1 }} {{ 'general.slider.of' | t }} {{ product.media.size }}'
                            class='xo-product-info-media-style1__thumb-slide'
                          >
                            {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: media.preview_image %}
                            <div class='xo-product-info-media-style1__media-icon xo-product-info-media-style1__media-icon--play'>
                              {% render 'icon', name: 'play', icon_size: '15' %}
                            </div>
                          </xo-carousel-slide>
                        {% endif %}
                    {% endcase %}
                  {% endunless %}
                {% else %}
                  {% comment %} If no featured_media, show all media {% endcomment %}
                  {% case media.media_type %}
                    {% when 'image' %}
                      <xo-carousel-slide
                        aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                        aria-label='{{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}'
                        class='xo-product-info-media-style1__thumb-slide'
                      >
                        {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: media.preview_image %}
                      </xo-carousel-slide>
                    {% when 'model' %}
                      <xo-carousel-slide
                        aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                        aria-label='{{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}'
                        class='xo-product-info-media-style1__thumb-slide'
                      >
                        {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: media.preview_image %}
                        <div class='xo-product-info-media-style1__media-icon'>
                          {% render 'icon', name: '3d-model', icon_size: '13' %}
                        </div>
                      </xo-carousel-slide>
                    {% else %}
                      {% if video_modal == false and product_360 == false %}
                        <xo-carousel-slide
                          aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                          aria-label='{{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}'
                          class='xo-product-info-media-style1__thumb-slide'
                        >
                          {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: media.preview_image %}
                          <div class='xo-product-info-media-style1__media-icon xo-product-info-media-style1__media-icon--play'>
                            {% render 'icon', name: 'play', icon_size: '15' %}
                          </div>
                        </xo-carousel-slide>
                      {% endif %}
                  {% endcase %}
                {% endif %}
              {% endfor %}
            {% elsif product.images.size > 0 %}
              {% comment %} Fallback to product.images if product.media is empty {% endcomment %}
              {% for image in product.images %}
                <xo-carousel-slide
                  aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                  aria-label='{{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}'
                  class='xo-product-info-media-style1__thumb-slide'
                >
                  {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: image %}
                </xo-carousel-slide>
              {% endfor %}
            {% elsif featured_image != blank %}
              {% comment %} Final fallback: use featured_image if nothing else is available {% endcomment %}
              <xo-carousel-slide
                aria-roledescription='{{ 'sections.slideshow.slide' | t }}'
                aria-label='1 {{ 'general.slider.of' | t }} 1'
                class='xo-product-info-media-style1__thumb-slide'
              >
                {% render 'media', media_aspect_ratio: media_aspect_ratio, type: 'image', media: featured_image %}
              </xo-carousel-slide>
            {% endif %}
          </xo-carousel-list>
        </xo-carousel-inner>
      </xo-carousel-thumbnail>
    </xo-carousel>
  </xo-gallery>
</div>
{% render 'product-info-media-mobile',
  product: product,
  hover_zoom_enabled: hover_zoom_enabled,
  click_zoom_enabled: click_zoom_enabled,
  autoplay: autoplay,
  video_modal: video_modal,
  product_360: product_360
%}
